---
title:  "[Development] Redis"
date: 2023-04-21 5:00PM
excerpt: "Dev"

author: Yuha
categories: [Development]
tags: [eng]

#toc: true
#toc_sticky: true
 
last_modified_at: 2023-04-21 5:00PM
---

# Redis
- an in-memory key-value store that can be used as a database, cache or message broker.
- Redis began as a caching database, but it has since evolved into a primary database. Many applications built today use Redis as a primary database.  However, most Redis service providers support Redis as a cache but not as a primary database.
- you can use Redis as both an in-memory cache and a primary database in a single system, thus eliminating the complexity and latency of two separate systems

## Redis as a Cache vs Redis as a Primary Database
- scalability (Scaling)
- fast performance >> real-time analytics, chat/messaging, media streaming, and pub/sub apps. 

<https://redis.com/blog/redis-cache-vs-redis-primary-database-in-90-seconds/#:~:text=Redis%20began%20as%20a%20caching,not%20as%20a%20primary%20database.>

## Spring Data Redis (What I used)
<https://docs.spring.io/spring-data/data-redis/docs/current/reference/html/>

### application.yml
```java
spring:
  cloud:
    cache:
      type: redis
      cache-names:
        - ***
        - ***
        - ***
    redis:
      host: ***
      lettuce:
        pool:
          max-active: **
          min-idle: **
```

### lettuce
- a Redis Java client that is fully non-blocking. 
- It supports both synchronous and asynchronous 
communication. 
- scalable
- thread-safe
- <https://www.baeldung.com/java-redis-lettuce>
- <https://redis.com/blog/jedis-vs-lettuce-an-exploration/#:~:text=What%20is%20Lettuce%3F,Sentinel%2C%20Pipelining%2C%20and%20codecs.>


- pooling
  - max-acitve : Maximum active connections to Redis instance
  - maxidle :  the max number of connections that can be idle in the pool **without being quickly closed** (the default value is 8)
  - minIdle : This is the number of connections that are ready for **immediate use.**
  - <https://medium.com/geekculture/the-pooling-of-connections-in-redis-e8188335bf64#:~:text=maxIdle%3A%20This%20is%20the%20max,a%20short%20period%20of%20time.>


#### max-active VS max-idle
-  max-active : the maximum number of active connections that can be allocated from this pool **at the same time.**
- max-idle : The maximum number of connections that should be kept in the pool **at all times.**
- <https://stackoverflow.com/questions/9451818/what-is-the-difference-between-maxactive-vs-maxidle-for-tomcat-connection-pools>


## how to use Redis-cli

```java
brew install redis ( default port : 6379)
redis-cli --raw -h ... -p ... (--raw : 한글 안깨져서 나옴)
>> ping (접속 테스트)
>> keys * 
>> get (key name)
```

---

# Caching
- 한번 처리한 데이터를 임시로 저장소에 저장하는 것으로, 이 임시 데이터를 동일하거나 유사 요청이 왔을 경우 저장소에서 바로 읽어와서 응답을 하여 성능 및 응답속도 향상을 위한 기술

## @Cachable vs @CacheEvict
- @Cacheable
  - 캐시가 있으면 캐시의 정보를 가져오고, 없으면 등록한다.

- @CacheEvict
  - 캐시삭제

```java
@Cacheable(cacheNames = CacheNames.DISCLOSURE)

@Cacheable(cacheNames = CacheNames.ADD_ATTR, key = “#root.methodName”, condition = “#result != null”)

@Cacheable(cacheNames = CacheNames.SUPPLIER, key = “#supplierCode”)

@Cacheable(value = “ownerCode”, key = “#result  == null”)
public String getOwnerCode() {...}

@Cacheable(cacheNames = CacheNames.PROMO, key = “#root.methodName”, unless =  “#result.isEmpty()”)

@CacheEvict(cacheNames = CacheNames.DISCLOSURE)

@CacheEvict(cacheNames = ”supplier”, key = “#request.supplierCode”)
public void changeSupplier(@NotNull SupplierModifyRequest request) {...}
```

- <https://yonguri.tistory.com/82>
