<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="[Spring] Apache Kafka + Spring Boot" /><meta name="author" content="Yuha" /><meta property="og:locale" content="en" /><meta name="description" content="spring" /><meta property="og:description" content="spring" /><link rel="canonical" href="https://uzzing.github.io/posts/Kafka/" /><meta property="og:url" content="https://uzzing.github.io/posts/Kafka/" /><meta property="og:site_name" content="YUHA👩🏻‍💻" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-01T15:02:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Spring] Apache Kafka + Spring Boot" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Yuha" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Yuha"},"description":"spring","headline":"[Spring] Apache Kafka + Spring Boot","dateModified":"2022-08-04T18:00:00+09:00","datePublished":"2022-08-01T15:02:00+09:00","url":"https://uzzing.github.io/posts/Kafka/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzing.github.io/posts/Kafka/"},"@context":"https://schema.org"}</script><title>[Spring] Apache Kafka + Spring Boot | YUHA👩🏻‍💻</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="YUHA👩🏻‍💻"><meta name="application-name" content="YUHA👩🏻‍💻"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">YUHA👩🏻‍💻</a></div><div class="site-subtitle font-italic">「A developer who seeks out big dream」</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/uzzing" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['uzzing1219','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[Spring] Apache Kafka + Spring Boot</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[Spring] Apache Kafka + Spring Boot</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Yuha </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Aug 1, 2022, 3:02 PM +0900" >Aug 1, 2022<i class="unloaded">2022-08-01T15:02:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Aug 4, 2022, 6:00 PM +0900" >Aug 4, 2022<i class="unloaded">2022-08-04T18:00:00+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2227 words">12 min read</span></div></div><div class="post-content"><h1 id="kafka">Kafka</h1><h2 id="structure">Structure</h2><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/83699657/182795803-c9bafbc5-4e84-47a6-9967-7b4263a59dd6.jpeg" alt="kafka" /></p><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/83699657/182566180-67da58a0-043b-4b61-b5f5-281d539d8edb.png" alt="img (5)" /></p><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/83699657/182565681-8a44d4d7-435b-4cec-a808-7c8ff5c35e8d.png" alt="img (4)" /></p><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/83699657/182560641-ceed1a92-3ff9-4016-bd67-d2a24e38852e.png" alt="img (3)" /></p><p><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/83699657/182552312-c55383b0-1b8c-49c0-8694-57f3bad80bcb.png" alt="img (2)" /></p><p><b><code class="language-plaintext highlighter-rouge">Record &lt; Partition &lt; Topic &lt; Broker &lt; Cluster</code></b></p><dl><dt><code class="language-plaintext highlighter-rouge">Topic</code><dd>메시지를 구분하는 논리적인 단위<dt><code class="language-plaintext highlighter-rouge">Partition</code><dd>모든 토픽은 각각 대응하는 하나 이상의 파티션이 브로커에 구성되고, 발행되는 토픽 메시지들은 파티션들에 나뉘어 저장됨.<ul><li>하나의 토픽에 대하여 여러 파티션을 구성하는 가장 큰 이유 : 분산 처리를 통한 성능 향상<li>하나의 파티션 내에서는 메시지 순서가 보장</ul><dt><code class="language-plaintext highlighter-rouge">Broker</code><dd>카프카 브로커는 프로듀서와 컨슈머 사이에서 메시지를 중계 카프카 브로커가 일반적으로 ‘카프카’라고 불리는 시스템임. 프로듀서와 컨슈머는 별도의 애플리케이션으로 구성되는 반면, 브로커는 카프카 자체이기 때문입니다. 따라서 ‘카프카를 구성한다’ 혹은 ‘카프카를 통해 메시지를 전달한다’에서 카프카는 브로커를 의미.<dt><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/83699657/182544455-0485dee0-fd0b-4c84-8e35-94c779d54b9d.png" alt="imgg" /><dt><code class="language-plaintext highlighter-rouge">Producer</code>, <code class="language-plaintext highlighter-rouge">Consumer</code><dd>Producer는 오직 끝에만 쓰며, Consumer는 오프셋을 기준으로 차례차례 읽어나감.<dt><code class="language-plaintext highlighter-rouge">Topics</code><dd>a particular stream of data<ul><li>you can have as many topics as you want<li>a topic is identified by its name<li>Topics are split in partitions<ul><li>Each partition is ordered<li>Each message within a paritition gets an incremental id, called offset</ul><li>동일한 토픽의 메시지들은 논리적으로 같은 문맥(context)을 가집</ul><dt><code class="language-plaintext highlighter-rouge">Message</code><dt><img data-proofer-ignore data-src="https://user-images.githubusercontent.com/83699657/182798092-751974e3-d905-423c-8238-25cd1f6036f2.png" alt="message" /><dd>Key(키)와 Value(값)로 구성<ul><li>브로커를 통해 메시지가 발행되거나 소비될 때, 메시지 전체가 직렬화/역직렬화됨<li>특정한 구조인 스키마(schema)를 가짐 &gt; 프로듀서가 발행하고 컨슈머가 소비할 때 메시지를 적절하게 처리하기 위해 필요 (만약 프로듀서와 컨슈머가 메시지에 대한 서로 다른 스키마를 가지고 있다면, 정상적인 처리를 할 수 없음)</ul><dt><code class="language-plaintext highlighter-rouge">Replica</code><dd>서비스 안정성과 장애 수용(Fault-Tolerance)에 관한 요소<ul><li>하나의 파티션은 1개의 리더 레플리카와 그 외 0개 이상의 팔로어 레플리카로 구성됨. 리더 레플리카는 파티션의 모든 쓰기, 읽기 작업을 담당. 반대로 팔로어 레플리카는 리더 레플리카로 쓰인 메시지들을 그대로 복제하고, 만약 리더 레플리카에 장애가 발생하는 경우, 리더 자리를 승계받을 준비를 함. 참고로 승계받을 준비가 된 즉, 리더 레플리카의 메시지를 적절하게 복제하여 리더 레플리카와 동기화된 레플리카들의 그룹을 ISR(In-Sync Replica)라고 함.<li>Replication-factor</ul><dt><code class="language-plaintext highlighter-rouge">Offset</code><dd>only have ameaning for a specific partition<ul><li>Ex. offset3 in partition0 doesn’t represent the same data as offset3 in partition1<li>Order is guaranteed <b>only within a partition</b> (not across paritions)</ul></dl><p><code class="language-plaintext highlighter-rouge">Data (Message / Record)</code></p><ul><li>Data is kept <b>only for a limited time</b> (default is one week)<ul><li>once the data is written to a partition, it’t be changed (<b>immutabiltiy</b>)<li><b>Data is assigned randomly to a partition</b> unless a key is provided (more on this later)</ul><li><p>necessary : offset, messageKey, messageValue</p><li>reference : <a href="https://always-kimkim.tistory.com/entry/kafka101-message-topic-partition">https://always-kimkim.tistory.com/entry/kafka101-message-topic-partition</a></ul><hr /><h2 id="features">Features</h2><ul><li>good solution for <b>large scale message processing</b> applications<li>better throughput, built-in partitioning, replication, and fault-tolerance, horizontal scalabiltiy<ul><li>messaging uses are often comparatively low-throughput<li>but may require <b>low end-to-end latency</b> and often depend on <b>the strong durability</b> guarantees (Kafka can provide)<li>kafka can scale to 100s of brokers<li>kafka can scale to milions of messages per second</ul><li>high performance (latency of less than 10ms) - real time<li>for the log history<li>for decoupling of data streams &amp; systems</ul><p><img width="555" alt="Screen Shot 2022-08-01 at 3 07 56 PM" src="https://user-images.githubusercontent.com/83699657/182082967-f77afa07-4cfd-44fa-a988-9349b7f153d0.png" /> <img width="1400" alt="Screen Shot 2022-08-02 at 10 20 35 AM" src="https://user-images.githubusercontent.com/83699657/182271467-03b6e200-0d21-4ad3-bb34-d7375dca63c3.png" /> <img width="1328" alt="Screen Shot 2022-08-02 at 10 20 51 AM" src="https://user-images.githubusercontent.com/83699657/182271476-2ba8e604-8239-4d78-928a-01efb24d3cd8.png" /> <img width="886" alt="Screen Shot 2022-08-02 at 9 58 37 AM" src="https://user-images.githubusercontent.com/83699657/182269324-5f670445-2147-4a12-8d7a-6a04a7f7b373.png" /></p><hr /><h2 id="use-cases">Use cases</h2><ul><li>messageing system<li>activity tracking<li>gather metrics from many different locations<li>application logs gathering<li>stream processing (with the kafka stream API or Spark for example)<li>De-coupling of system dependencies<li><p>Integration with Spark, Flink, Storm, Hadoop and many other Big Data technologies</p><li>key point : <code class="language-plaintext highlighter-rouge">in real-time</code></ul><p><img width="879" alt="Screen Shot 2022-08-02 at 9 57 48 AM" src="https://user-images.githubusercontent.com/83699657/182269261-3eceec6b-0870-4c4e-bc7f-9510bda9917c.png" /></p><hr /><h2 id="kafka-vs-rabbitmq">Kafka VS RabbitMQ</h2><div class="table-wrapper"><table><thead><tr><th style="text-align: center"> <th style="text-align: center"><strong>Kafka</strong><th style="text-align: center"><strong>RabbitMQ</strong><tbody><tr><td style="text-align: center"> <td style="text-align: center">distributed event streaming platform<td style="text-align: center">open source distributed message broker<tr><td style="text-align: center"> <td style="text-align: center">pub/sub (생산자가 원하는 각 메시지를 게시할 수 있도록 하는 메시지 배포 패턴)<td style="text-align: center">message broker (응용프로그램, 서비스 및 시스템이 정보를 통신하고 교환할 수 있도록 하는 소프트웨어 모듈)<tr><td style="text-align: center"> <td style="text-align: center">복잡한 라우팅에 의존하지 않고 최대 처리량으로 스트리밍하는 데 가장 적합, 다단계 파이프라인에서 데이터를 처리<td style="text-align: center">복잡한 라우팅, 신속한 요청-응답이 필요한 웹 서버에 적합</table></div><ul><li>reference : <a href="https://coding-nyan.tistory.com/129">https://coding-nyan.tistory.com/129</a></ul><hr /><ul><li>reference : Apache Kafka in 5 minutes</ul><p><a href="https://www.youtube.com/watch?v=PzPXRmVHMxI">https://www.youtube.com/watch?v=PzPXRmVHMxI</a> Apache Kafka in 6 minutes <a href="https://www.youtube.com/watch?v=Ch5VhJzaoaI">https://www.youtube.com/watch?v=Ch5VhJzaoaI</a> <br /> <a href="https://always-kimkim.tistory.com/entry/kafka101-broker">https://always-kimkim.tistory.com/entry/kafka101-broker</a></p><hr /><h2 id="internalexternal-structure">Internal/External Structure</h2><p><img width="989" alt="Screen Shot 2022-08-02 at 10 04 14 AM" src="https://user-images.githubusercontent.com/83699657/182269867-14be3791-c725-4471-bc15-55c19f6bb2e9.png" /> <img width="909" alt="Screen Shot 2022-08-02 at 10 05 11 AM" src="https://user-images.githubusercontent.com/83699657/182269904-db3bca80-f40f-4b9c-a795-3ff5de5fbe2b.png" /> <img width="991" alt="Screen Shot 2022-08-02 at 10 08 27 AM" src="https://user-images.githubusercontent.com/83699657/182270253-7097204f-b15b-48c4-809c-36f72b3af5a7.png" /> <img width="986" alt="Screen Shot 2022-08-02 at 10 10 38 AM" src="https://user-images.githubusercontent.com/83699657/182270474-5974e6ae-9fee-40d5-aeca-75c0f2869a0e.png" /> <img width="1709" alt="Screen Shot 2022-08-02 at 10 14 03 AM" src="https://user-images.githubusercontent.com/83699657/182270801-0cdd0500-2735-4d11-be88-3a5f6c25a4aa.png" /></p><hr /><h2 id="example">Example</h2><p>build.gradle</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">dependencies</span> <span class="o">{</span>
  <span class="nl">implementation:</span> <span class="s">"spring-kafka"</span>
<span class="o">}</span>
</pre></table></code></div></div><p>application.yml</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nl">spring:</span>
  <span class="nl">kafka:</span>
    <span class="n">bootstrap</span><span class="o">-</span><span class="nl">servers:</span> <span class="nl">localhost:</span><span class="mi">9092</span>
</pre></table></code></div></div><p>KafkaTopicConfig.java</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaTopicConfig</span> <span class="o">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">NewTopic</span> <span class="nf">amgifoscodeTopic</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// NewTopic : org.apache.kafka.clients.admin.NewTopic</span>
    <span class="k">return</span> <span class="nc">TopicBuilder</span><span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="s">"amigoscode"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>Output <img width="1584" alt="Screen Shot 2022-08-02 at 10 54 37 AM" src="https://user-images.githubusercontent.com/83699657/182275052-a0ef2d05-e498-438e-b2b9-fc9cfbbd7941.png" /> <img width="1178" alt="Screen Shot 2022-08-02 at 11 10 13 AM" src="https://user-images.githubusercontent.com/83699657/182276744-0d138fed-36cb-494d-9339-8a04aea0f0d1.png" /></p></blockquote><dl><dt>Terminal<dd><a href="https://kafka.apache.org/quickstart">https://kafka.apache.org/quickstart</a> + additional command : <a href="https://sangchul.kr/144">https://sangchul.kr/144</a></dl><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>cd kafka_2.12-3.2.1

bin/zookeeper-server-start.sh config/zookeeper.properties

bin/kafka-server-start.sh config/server.properties

// Create a topic
bin/kafka-topics.sh --create --topic quickstart-events --bootstrap-server localhost:9092

// Read the events (topic --&gt; amigoscode)
bin/kafka-console-consumer.sh --topic amigoscode --from-beginning --bootstrap-server localhost:9092
</pre></table></code></div></div><p>KafkaProducerConfig.java</p><ul><li>Use <code class="language-plaintext highlighter-rouge">KafkaTemplate</code> for implemeting producer<ul><li>KafkaProducer.send() in KafkaTemplate.send()</ul><li>reference : <a href="https://jessyt.tistory.com/142">https://jessyt.tistory.com/142</a><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaProducerConfig</span> <span class="o">{</span>

  <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.kafka.bootstrap-servers}"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">bootstrapServers</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">producerConfig</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
      <span class="n">properties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> <span class="n">bootstrapServers</span><span class="o">);</span>
      <span class="n">properties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">KEY_SERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">StringSerializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">properties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">StringSerializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">properties</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">ProducerFactory</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">producerFactory</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nc">DefaultKafkaProducerFactory</span><span class="o">&lt;&gt;(</span><span class="n">producerConfig</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">KafkaTemplate</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">kafkaTemplate</span><span class="o">(</span><span class="nc">ProducerFactory</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">producerFactory</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nc">KafkaTemplate</span><span class="o">&lt;&gt;(</span><span class="n">producerFactory</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="c1">// KafkaTemplate&lt;String, Object&gt; ~~~</span>
<span class="o">}</span>
</pre></table></code></div></div></ul><p>KafkaConsumerConfig.java</p><ul><li><p>Use <code class="language-plaintext highlighter-rouge">ConcurrentKafkaListenerContainerFactory</code> for implementing consumer</p><li><p>reference : <a href="https://semtax.tistory.com/83">https://semtax.tistory.com/83</a></p></ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaConsumerConfig</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"localhost:9092"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">bootstrapServers</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">consumerConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">properties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> <span class="n">bootstrapServers</span><span class="o">);</span>
        <span class="n">properties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">StringSerializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">properties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">StringSerializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">properties</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ConsumerFactory</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">consumerFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">DefaultKafkaConsumerFactory</span><span class="o">&lt;&gt;(</span><span class="n">consumerConfig</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">KafkaListenerContainerFactory</span><span class="o">&lt;</span><span class="nc">ConcurrentMessageListenerContainer</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="nf">factory</span><span class="o">(</span><span class="nc">ConsumerFactory</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">consumerFactory</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ConcurrentKafkaListenerContainerFactory</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcurrentKafkaListenerContainerFactory</span><span class="o">&lt;&gt;();</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">setConsumerFactory</span><span class="o">(</span><span class="n">consumerFactory</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">factory</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// ConcurrentKafkaListenerContainerFactory&lt;String, Object&gt; ~~~</span>
<span class="o">}</span>
</pre></table></code></div></div><p>KafkaApplication.java</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaexampleApplication</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">KafkaexampleApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nc">CommandLineRunner</span> <span class="nf">commandLineRunner</span><span class="o">(</span><span class="nc">KafkaTemplate</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">kafkaTemplate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">kafkaTemplate</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"amigoscode"</span><span class="o">,</span> <span class="s">"hello kafka"</span><span class="o">);</span> <span class="c1">// topic, data(message)</span>
        <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><dl><dt>KafkaTemplate.send()<dd>it goes through different layers before the message is sent to Kafka.</dl><p>KafkaListeners.java</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">@Componenet</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaListeners</span> <span class="o">{</span>
  <span class="nd">@KafkaListener</span><span class="o">(</span><span class="n">topics</span> <span class="o">=</span> <span class="s">"amigoscode"</span><span class="o">,</span> <span class="n">groupId</span> <span class="o">=</span> <span class="s">"groupId"</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">listener</span><span class="o">(</span><span class="nc">String</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Listener received: "</span> <span class="o">+</span> <span class="n">data</span> <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>MessageRequest.java</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre>
<span class="c1">// record</span>
<span class="kd">public</span> <span class="n">record</span> <span class="nf">MessageRequest</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
<span class="o">}</span>

<span class="o">=</span>

<span class="c1">// class</span>
<span class="c1">// Records provide a public constructor (with all arguments), read methods for each field (equivalent to getters) and the implementation of hashCode, equals and toString methods.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageRequest</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MessageRequest</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">MessageRequest</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">""</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p>MessageController.java</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"api/vi/messages"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageController</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">KafkaTemplate</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">kafkaTemplate</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">MessageController</span><span class="o">(</span><span class="nc">KafkaTemplate</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">kafkaTemplate</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kafkaTemplate</span> <span class="o">=</span> <span class="n">kafkaTemplate</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@PostMapping</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">publish</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">MessageReqeust</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">kafkaTemplate</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"amigoscode"</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>Output <img width="1115" alt="Screen Shot 2022-08-02 at 1 16 46 PM" src="https://user-images.githubusercontent.com/83699657/182290616-93b5808c-a4e1-42a4-87db-6530872a2a5f.png" /></p></blockquote><h3 id="api-test">API TEST</h3><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="no">POST</span> <span class="nl">http:</span><span class="c1">//localhost:8080/api/vi/messages</span>
<span class="nc">Content</span><span class="o">-</span><span class="nl">Type:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>

<span class="o">{</span>
  <span class="s">"message"</span><span class="o">:</span> <span class="s">"Api With Kafka"</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>Output <img width="1650" alt="Screen Shot 2022-08-02 at 1 28 05 PM" src="https://user-images.githubusercontent.com/83699657/182291786-83b96631-26f7-4c70-aac2-44565f41a457.png" /></p></blockquote><ul><li>reference :<ul><li><p>Apache Kafka in 5 minutes <a href="https://www.youtube.com/watch?v=PzPXRmVHMxI">https://www.youtube.com/watch?v=PzPXRmVHMxI</a></p><li><p>Kafka Tutorial - Spring Boot Microservices <a href="https://www.youtube.com/watch?v=SqVfCyfCJqw">https://www.youtube.com/watch?v=SqVfCyfCJqw</a></p><li><p>Kafka Topics, Partitions and Offsets Explained <a href="https://www.youtube.com/watch?v=_q1IjK5jjyU">https://www.youtube.com/watch?v=_q1IjK5jjyU</a></p></ul></ul><hr /><h1 id="kafka-stream">Kafka Stream</h1><ul><li><p>kafka streams api를 사용하여, 지속적으로 흘러들어오는 데이터에 대한 분석, 처리를 위한 client library</p><li><p>어떤 Topic으로 들어오는 데이터를 Consume하여, streams api를 통해 처리 후 다른 Topic으로 전송(Producing) 하거나 끝내는 행위</p><li><p>Spring cloud stream에서 제공하는 Binder라는 구현체를 중간에 두고 통신하기 때문에, 어느 하나의 미들웨어에 강결합 되어있지 않은 상태에서 애플리케이션을 개발</p></ul><div class="table-wrapper"><table><thead><tr><th style="text-align: center"> <th style="text-align: center">binder<th style="text-align: center">bindings(input/output)<tbody><tr><td style="text-align: center"> <td style="text-align: center">메시지 broker 정보<td style="text-align: center">메세지를 전송할 채널정보<tr><td style="text-align: center"> <td style="text-align: center">미들웨어와의 통신을 담당하는 컴포넌트<td style="text-align: center">미들웨어와 통신을 위한 브릿지<tr><td style="text-align: center"> <td style="text-align: center">미들웨어(kafka)와 producer 및 consumer의 연결, 위임 및 라우팅 등을 담당<td style="text-align: center">바인더의 입/출력을 미들웨어(kafka)에 연결하기 위한 Bridge</table></div><hr /><h2 id="example-1">Example</h2><p>build.gradle</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">implementation</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">cloud</span><span class="o">:</span><span class="n">spring</span><span class="o">-</span><span class="n">cloud</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">stream</span><span class="o">-</span><span class="n">kafka</span><span class="err">'</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="default-interface">Default interface</h3><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Sink</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="no">INPUT</span> <span class="o">=</span> <span class="s">"process-input"</span><span class="o">;</span> <span class="c1">// INPUT : consumer 입장에서 subscribe 받을 TOPIC명</span>

    <span class="nd">@Input</span><span class="o">(</span><span class="no">INPUT</span><span class="o">)</span>
    <span class="nc">SubscribableChannel</span> <span class="nf">input</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Source</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="no">OUTPUT</span> <span class="o">=</span> <span class="s">"process-output"</span><span class="o">;</span> <span class="c1">// OUTPUT : producer 입장에서 publish할 TOPIC명</span>

    <span class="nd">@Output</span><span class="o">(</span><span class="no">OUTPUT</span><span class="o">)</span>
    <span class="nc">MessageChannel</span> <span class="nf">output</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Processor</span> <span class="kd">extends</span> <span class="nc">Source</span><span class="o">,</span> <span class="nc">Sink</span> <span class="o">{</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="custom-interface">Custom interface</h3><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProcessMessage</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="no">SEND_MESSAGE</span> <span class="o">=</span> <span class="s">"send-message"</span><span class="o">;</span>
    <span class="nc">String</span> <span class="no">RECEIVE_MESSAGE</span> <span class="o">=</span> <span class="s">"receive-message"</span><span class="o">;</span>

    <span class="nd">@Output</span><span class="o">(</span><span class="no">SEND_MESSAGE</span><span class="o">)</span>
    <span class="nc">MessageChannel</span> <span class="nf">sendMessage</span><span class="o">();</span>

    <span class="nd">@Input</span><span class="o">(</span><span class="no">RECEIVE_MESSAGE</span><span class="o">)</span>
    <span class="nc">SubscribableChannel</span> <span class="nf">getMessage</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@ConditionalOnProperty</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"spring.cloud.stream.enabled"</span><span class="o">,</span> <span class="n">havingValue</span> <span class="o">=</span> <span class="s">"true"</span><span class="o">,</span> <span class="n">matchIfMissing</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nd">@EnableBinding</span><span class="o">(</span><span class="nc">EventSource</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageConsumer</span> <span class="o">{</span>

  <span class="nd">@StreamListener</span><span class="o">(</span><span class="n">target</span> <span class="o">=</span> <span class="nc">ProcessMessage</span><span class="o">.</span><span class="na">RECEIVE_MESSAGE</span><span class="o">,</span> <span class="n">condition</span> <span class="o">=</span> <span class="s">"headers['eventType'] == 'MessageEvent'"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">pushMessage</span><span class="o">(</span><span class="nc">MessageEvent</span> <span class="n">event</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JsonProcessingException</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageEvent</span> <span class="o">{</span>
  <span class="c1">// props</span>
<span class="o">}</span>
</pre></table></code></div></div><p>application.yml</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nl">spring:</span>
  <span class="nl">cloud:</span>
    <span class="nl">stream:</span>
      <span class="nl">enable:</span>
      <span class="nl">kafka:</span>
        <span class="nl">binder:</span>
          <span class="nl">brokers:</span> <span class="n">localhost</span> <span class="c1">// broker ip</span>
          <span class="err">#</span> <span class="n">replication</span><span class="o">-</span><span class="nl">factor:</span> <span class="mi">2</span> <span class="c1">// minimum = 2</span>
          <span class="err">#</span> <span class="n">auto</span><span class="o">-</span><span class="n">create</span><span class="o">-</span><span class="nl">topics:</span> <span class="kc">false</span>
        <span class="nl">bindings:</span> <span class="c1">// input/output</span>
          <span class="n">receive</span><span class="o">-</span><span class="nl">message:</span> <span class="c1">// channel name</span>
            <span class="nl">destination:</span> <span class="s">"${spring.cloud.stream.topic:}process-input"</span> <span class="c1">// topic name</span>
            <span class="nl">group:</span> <span class="s">"${spring.cloud.stream.consumer.group:}"</span> <span class="c1">// consumer group id</span>
          <span class="n">send</span><span class="o">-</span><span class="nl">message:</span> <span class="c1">// output</span>
            <span class="nl">destination:</span> <span class="s">"${spring.cloud.stream.topic:}process-output"</span>
</pre></table></code></div></div><hr /><h2 id="related-annotations">Related Annotations</h2><h3 id="enablebinding">@EnableBinding</h3><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nd">@EnableBinding</span><span class="o">(</span><span class="nc">EventSource</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</pre></table></code></div></div><h3 id="kafkalistener">@KafkaListener</h3><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nd">@KafkaListener</span><span class="o">(</span><span class="n">topics</span> <span class="o">=</span> <span class="s">"amigoscode"</span><span class="o">,</span> <span class="n">groupId</span> <span class="o">=</span> <span class="s">"groupId"</span><span class="o">)</span>
</pre></table></code></div></div><h3 id="conditionalonproperty">@ConditionalOnProperty(…)</h3><blockquote><p>enables bean registration only if an environment property is present and has a specific value.</p></blockquote><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nd">@ConditionalOnProperty</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"spring.cloud.stream.enabled"</span><span class="o">,</span> <span class="n">havingValue</span> <span class="o">=</span> <span class="s">"true"</span><span class="o">,</span> <span class="n">matchIfMissing</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</pre></table></code></div></div><ul><li>condition : spring.cloud.stream.enabled:true (in application.yml)<li>name (=value) : key in application.yml<li>havingValue : value of key in application.yml<li>matchIfMissing : whether create a bean even if not matching</ul><h3 id="conditionalonmissingbean">@ConditionalOnMissingBean</h3><hr /><ul><li>reference : <a href="https://saramin.github.io/2019-08-28-2/">https://saramin.github.io/2019-08-28-2/</a> <br /></ul><p><a href="https://piotrminkowski.com/2021/11/11/kafka-streams-with-spring-cloud-stream/">https://piotrminkowski.com/2021/11/11/kafka-streams-with-spring-cloud-stream/</a> <br /> <a href="http://www.chidoo.me/index.php/2016/11/06/building-a-messaging-system-with-kafka/">http://www.chidoo.me/index.php/2016/11/06/building-a-messaging-system-with-kafka/</a> <br /> <a href="https://jaehun2841.github.io/2019/12/23/2019-12-23-kafka-streams-binder-feature/#Version-Up">https://jaehun2841.github.io/2019/12/23/2019-12-23-kafka-streams-binder-feature/#Version-Up</a> <br /> <a href="https://sangchul.kr/144">https://sangchul.kr/144</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/development/'>Development</a>, <a href='/categories/spring/'>Spring</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/eng/" class="post-tag no-text-decoration" >eng</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[Spring] Apache Kafka + Spring Boot - YUHA👩🏻‍💻&url=https://uzzing.github.io/posts/Kafka/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[Spring] Apache Kafka + Spring Boot - YUHA👩🏻‍💻&u=https://uzzing.github.io/posts/Kafka/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[Spring] Apache Kafka + Spring Boot - YUHA👩🏻‍💻&url=https://uzzing.github.io/posts/Kafka/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/cloudfront/">[AWS] Cloudfront</a><li><a href="/posts/redis/">[Development] Redis</a><li><a href="/posts/ElasticSearch-detail/">[Development] ElasticSearch - UpdateByQuery</a><li><a href="/posts/Stopwatch/">[Development] StopWatch</a><li><a href="/posts/renewal-of-residence-period/">[Tokyo] 在留期間更新申請</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/eng/">eng</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/certification/">certification</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/programmers/">programmers</a> <a class="post-tag" href="/tags/datastructure/">datastructure</a> <a class="post-tag" href="/tags/codility/">codility</a> <a class="post-tag" href="/tags/diary/">diary</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Spring-Boot-Microservices/"><div class="card-body"> <span class="timeago small" >Jul 29, 2022<i class="unloaded">2022-07-29T15:02:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Spring] Microservices in Spring Boot</h3><div class="text-muted small"><p> How to communicate microservices @FeignClient (ApiClient) Kafka (Use Event) RestTemplate (communicate with REST API) Circuit Breaker (Fault Tolerant Design Pattern) Spring Cloud a fram...</p></div></div></a></div><div class="card"> <a href="/posts/MSA/"><div class="card-body"> <span class="timeago small" >Feb 14<i class="unloaded">2023-02-14T15:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Development] MSA</h3><div class="text-muted small"><p> Strength 독립적으로 배포 가능하고 개발자의 자율성 증가 장애나는 서비스 격리를 통한 서버 재기동 시간 단축 팀별 코드 이해도 증가 및 유지보수 난이도 저하 Weakness 유지보수 난이도 증가 (통합테스트) API 관리의 중요성 증가 ...</p></div></div></a></div><div class="card"> <a href="/posts/HTTP-status-code/"><div class="card-body"> <span class="timeago small" >Aug 17, 2022<i class="unloaded">2022-08-17T15:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Development] HTTP Status Code</h3><div class="text-muted small"><p> Rules Common HTTP Status Codes Status Code Meaning 200 OK the HTTP request was successfully carried out 201 Created the ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Spring-Boot-Microservices/" class="btn btn-outline-primary" prompt="Older"><p>[Spring] Microservices in Spring Boot</p></a> <a href="/posts/algorithm-remove-duplicates-from-sorted-array/" class="btn btn-outline-primary" prompt="Newer"><p>[Easy] Remove Duplicates from Sorted Array</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://uzzing.github.io/posts/Kafka/'; this.page.identifier = '/posts/Kafka/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://YUHA.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/uzzing">YUHA JO</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/eng/">eng</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/certification/">certification</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/programmers/">programmers</a> <a class="post-tag" href="/tags/datastructure/">datastructure</a> <a class="post-tag" href="/tags/codility/">codility</a> <a class="post-tag" href="/tags/diary/">diary</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://uzzing.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
